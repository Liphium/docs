<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Liphium Town Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/tabs.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Liphium Town Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to the new Liphium Documentation, specifically for Town administrators. This will from now on be the place where all advanced tutorials will be put. If you're here as a regular Liphium user wondering how to do some stuff in the app, you may wanna go to the <a href="https://liphium.com/docs">help &amp; resources page</a> on the main website.</p>
<p>For now, we just have the <a href="/setup/docker.html">guide on how to set up a Town using Docker</a>.</p>
<p>If you're looking at this and wondering how to migrate from 0.4.0 to 0.5.0/0.5.1, you check out the <a href="/migration/0.5-migration.html">migration guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="town-setup"><a class="header" href="#town-setup">Town setup</a></h1>
<p>Welcome to the part of the documentation where I teach you how to deploy a town on your own server. Please understand that I don't have infinite time to cover every method, so if you have anything missing, you can contribute it on the <a href="https://github.com/Liphium/docs">GitHub repository for this page</a>. I'm happy about every single thing we can add to this documentation because there are always people that use something different than you.</p>
<p>For now we have the following guides available:</p>
<ul>
<li><a href="setup//setup/docker.html">Creating a Town using Docker</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker"><a class="header" href="#docker">Docker</a></h1>
<p>So you want to make your own town, eh? Well <strong>if you've never touched a server you probably shouldn't attempt this</strong> as servers (especially with Linux) are not a newbie-friendly environment. But with that out of the way or if you're seeking a challenge, let's get a fresh new town onto your server!</p>
<p>Also before we get started, you can always message me on Discord if you have any kind of problem with the installation or have some kind of other question. You can get to the Liphium Discord server through the invite in the navigation bar or menu at the top of the page.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<p>Please make sure you have everything you need installed before installing Liphium because otherwise it can be quite a bit of pain to get everything set up.</p>
<ul>
<li>A domain that you will <a href="setup/docs/general/faq/#why-do-i-need-a-domain-for-my-town">never change or sell</a> (read the linked FAQ question for more information).</li>
<li>A server running Linux.</li>
<li>The latest version of Docker. You can learn how install it <a href="https://docs.docker.com/engine/install/">here</a>.</li>
<li>A mail server for Liphium to send you emails with SMTP credentials (it is required or registration will fail when people try to make an account).</li>
<li>A PostgreSQL server that you can connect to.</li>
<li>Decent skills with Docker (there might be issues).</li>
</ul>
<h2 id="tools-we-will-use"><a class="header" href="#tools-we-will-use">Tools we will use</a></h2>
<p>Alright, one more thing before we get started on the installation. I just want you to know what we are going to use so everything is clear. I'll have instructions on how to install Nginx and Certbot later. Although I just link you to their websites, respectively.</p>
<ul>
<li><strong>Nginx</strong>: Nginx is a reverse proxy for web requests that we'll use to expose your Liphium town to the outside world. We use it here because we're gonna create multiple domains pointing to the your server and it wouldn't be possible without nginx. We also need it to install SSL certificates for your domain so you can use the app properly.</li>
<li><strong>PostgreSQL</strong>: The database we're going to use for Liphium. All of your data is stored in here.</li>
<li><strong>Certbot</strong>: Well, this is gonna be the way we make your Liphium town secure by installing SSL certificates for your domain. It's completely free and really easy to use. I even donated 10€ because it's just awesome. <a href="https://supporters.eff.org/donate/support-work-on-certbot">You can too</a>.</li>
<li><strong>Docker</strong>: Docker is going to be used to install the actual Liphium server (called station) onto your server. We're going to install PostgreSQL using Docker as well.</li>
</ul>
<p>With all of that explained, let's finally get to installing.</p>
<h2 id="step-1-getting-your-postgresql-server-ready"><a class="header" href="#step-1-getting-your-postgresql-server-ready">Step 1: Getting your PostgreSQL server ready</a></h2>
<p>Connect to your PostgreSQL server and let's create a few databases. We're going to need two databases: One for all of the accounts and one for all of the chat messages. You can create those two by typing <code>CREATE DATABASE chat; CREATE DATABASE main;</code>. Different names can also be used, just be sure to use the correct ones later.</p>
<h2 id="step-2-creating-the-actual-liphium-town"><a class="header" href="#step-2-creating-the-actual-liphium-town">Step 2: Creating the actual Liphium town</a></h2>
<p><strong>1.</strong> Alright, now it's time for you to venture out by yourself for the first time. And that's to <a href="https://docs.docker.com/engine/install/">installing Docker</a>. They have amazing documentation over there and you should hopefully be able to get it running your machine. Complete it until the end where they tell you to run the hello-world image and when you've done all of that, you can come back here.</p>
<p><strong>2.</strong> If you haven't done so already, it's a good time to make a folder for all of the files for your Liphium town now (like /home/liphium or something). But now, let's pull the official Liphium image from Docker Hub: <code>docker pull liphium/chat:latest</code>.</p>
<p><strong>3.</strong> Before we start getting into the configuration file, it's a good time to actually get your domain records set up. They will sometimes take a long time to be applied and if we're lucky they will already be ready when we get to actually connecting to the town.</p>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Name</th><th>Content</th><th>Description</th></tr></thead><tbody>
<tr><td>A</td><td>main</td><td>YOUR_IP_HERE</td><td>The domain of the main instance (will be entered in Liphium)</td></tr>
<tr><td>A</td><td>chat</td><td>YOUR_IP_HERE</td><td>The domain of your chat server</td></tr>
<tr><td>A</td><td>spaces</td><td>YOUR_IP_HERE</td><td>The domain of your Spaces server</td></tr>
</tbody></table>
</div>
<p><strong>4.</strong> Now let's create the configuration/environment file for your Liphium town. To do this, please follow our <a href="setup/./config-setup.html#creating-a-new-configuration">config setup guide</a> and come back here once you finished creating the config.</p>
<p><strong>5.</strong> If you chose local storage for your files, please create a folder called <code>files</code> in the current directory. All of your files will go into there.</p>
<p><strong>6.</strong> Now run the docker container by using the command below. Make sure to replace <code>config.env</code> with the name of your environment/configuration file (or leave it alone if you called yours <code>config.env</code>).</p>
<pre><code class="language-sh">docker run --env-file config.env -p 127.0.0.1:4002:4002 -p 127.0.0.1:4001:4001 -p 127.0.0.1:4000:4000 -v ./files:/home liphium/chat
</code></pre>
<p><strong>7.</strong> Alright, after running the container once, it should print out that you should set <code>TC_PUBLIC_KEY</code> and <code>TC_PRIVATE_KEY</code>. Take the thing the container printed out and just add it to the bottom of <code>config.env</code>. Make sure to set both of those environment/configuration variables from the same run of Liphium. Otherwise they are not going to work together. Also make sure you remove the all the spaces and the double quotes. It should look something like this: <code>TC_PUBLIC_KEY=value</code>. <code>value</code> should not be surrounded by ", otherwise starting your town will not work. Do the same for <code>TC_PRIVATE_KEY</code> as well.</p>
<p><strong>8.</strong> Now, for the last time, run the container again. It's going to ask you to set the <code>SYSTEM_UUID</code> environment variable to the thing it prints out. Also give it the same treatment as above and make it look like this: <code>SYSTEM_UUID=value</code>. <code>value</code> should again not be surrounded by ", otherwise station will not work.</p>
<p><strong>9.</strong> Your setup of the main Liphium town is now complete. You should now be able to just run the thing and it should already be connecting to the database. The only thing that shouldn't work is grabbing the server public key. But we're going to fix that now.</p>
<h2 id="step-3-exposing-your-town-to-the-internet-with-nginx"><a class="header" href="#step-3-exposing-your-town-to-the-internet-with-nginx">Step 3: Exposing your town to the internet with Nginx</a></h2>
<h1 id="todo-finish-tutorial-here"><a class="header" href="#todo-finish-tutorial-here">TODO: Finish tutorial here</a></h1>
<p><strong>1.</strong> First, you of course need to install Nginx. If you are on Ubuntu or Debian, you can just run the command below. If not, you might have to look up a tutorial on how to do it or just use the package your package manager provides (if it exists).</p>
<pre><code class="language-sh">apt install nginx
</code></pre>
<p><strong>2.</strong> After installing Nginx, we're going to need to set up a few sites. There should already be a directory called <code>/etc/nginx/sites-available</code>, but if it is not there, just create it. Enter this directory.</p>
<p><strong>3.</strong> Now you're going to need two configs again. As usual, just download them from <a href="https://gist.github.com/Unbreathable/0469cfd271b84340429c140dde830642">here</a>. This time it's three files though. Make sure you grab all of them and put them into the <code>/etc/nginx/sites-available</code> folder.</p>
<p><strong>4.</strong> Change the domains in the configurations (behind <code>server_name</code>) you just downloaded from me to reflect your domain setup (for example: main.liphium.com -&gt; main.example.com). Make sure to not forget the semicolon at the end!</p>
<p><strong>5.</strong> Let's make Nginx actually use those configurations. To do that just run the commands below to create links to the files in the <code>/etc/nginx/sites-enabled</code> folder.</p>
<pre><code class="language-sh">ln -s /etc/nginx/sites-available/liphium-main /etc/nginx/sites-enabled/liphium-main
ln -s /etc/nginx/sites-available/liphium-chat /etc/nginx/sites-enabled/liphium-chat
ln -s /etc/nginx/sites-available/liphium-spaces /etc/nginx/sites-enabled/liphium-spaces
</code></pre>
<p><strong>6.</strong> Run <code>nginx -t</code> to validate that the configurations work properly. If they don't, do what the command tells you to fix the configurations up bit by bit.</p>
<p><strong>7.</strong> You can now restart Nginx by typing <code>systemctl restart nginx</code>. You should now have the configurations loaded.</p>
<h2 id="step-4-adding-ssl-certificates-to-your-town-using-certbot"><a class="header" href="#step-4-adding-ssl-certificates-to-your-town-using-certbot">Step 4: Adding SSL certificates to your town using Certbot</a></h2>
<p><strong>1.</strong> For Certbot to work, there are actually two things you need to install. You can follow <a href="https://certbot.eff.org/instructions?ws=nginx&amp;os=snap">this guide</a> from the official website. <strong>Please follow their guide until step 5</strong>.</p>
<p><strong>2.</strong> To secure your town, we first need to make sure your domains are already updated and already redirect to the correct server. To verify if they are already set up correctly, go to <code>main.yourdomain.com</code> (or whatever you used) and check if there is some sort of error from nginx. If it's not there yet, you'll have to wait a little bit before getting your certificates. This is because your domain isn't pointing to the server yet. This can take up to 48 hours to happen in some cases. So if this happened to you just be patient for now, I know this sucks, but it can happen.</p>
<p><strong>3.</strong> When you did see the error from nginx, you can now just run <code>certbot --nginx</code> to apply the certificates. The CLI will ask your for a few things. For example, they'll ask you to enter your email address. Please do, so you are always notified if something is wrong with your certificates. When they finally ask which domains you want to secure, just leave the field blank to select all of them. Certbot will then do its magic and you are officially done with the setup.</p>
<h2 id="step-5-getting-into-your-town"><a class="header" href="#step-5-getting-into-your-town">Step 5: Getting into your town</a></h2>
<p>When you now connect to your Liphium town for the first time with any client app, you can enter the <code>SYSTEM_UUID</code> environment variable as the invite. This is an invite created to make sure an account can be created.</p>
<p>If you just created the first account on your Liphium town, it will automatically have admin permissions. You can now go to Settings -&gt; Invites -&gt; Generate invite to invite other people to your town.</p>
<h2 id="were-finally-done"><a class="header" href="#were-finally-done">We're finally done</a></h2>
<p>I know it took a long time to get Liphium installed. Thanks for following this guide until now and I hope you didn't run into too many issues. I'm tired now and I'm gonna go watch a few episodes of Shikanoko now. This thing took like 3-4 hours to write and I hope it helped.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>This page will teach you all about the configuration file/environment variables required for your Liphium town. If you haven't followed a guide for installation, please find one that suites your needs right in the menu/sidebar.</p>
<p>If you came here from an installation tutorial, you can skip straight to the <a href="setup/config-setup.html#creating-a-new-configuration">creating a new configuration</a> part.</p>
<h2 id="an-overview-of-the-configuration"><a class="header" href="#an-overview-of-the-configuration">An overview of the configuration</a></h2>
<p>First, here is a basic overview with explanations of every configuration value.</p>
<pre><code class="language-sh"># Domain config
#
# The base paths of all your servers and their servers. Liphium uses this
# to tell the client the domain of the server.
BASE_PATH=main.liphium.com
BASE_PORT=4000
CHAT_NODE=chat.liphium.com
CHAT_NODE_PORT=4001
SPACE_NODE=spaces.liphium.com
SPACE_NODE_PORT=4002

# App config
#
# APP_NAME is used in emails (you can change it) to the people in your town.
# The other values should just be kept the default (if you're not a dev).
# LISTEN is what address station will listen on.
# CLI enables a command line utility for developers (off by default).
# PROTOCOL is how the backend will contact the chat server and space station.
APP_NAME=Liphium
LISTEN=0.0.0.0
CLI=false
PROTOCOL=https://

# Test mode config
#
# TESTING is if station should be ran in testing mode or not.
# We recommend leaving TESTING on to see logs more clearly and be able to report
# errors to us more easily.
# TESTING_AMOUNT generates testing tokens. 0 is the best value to keep it at.
# If it isn't there, station will crash on startup.
TESTING=true
TESTING_AMOUNT=0

# Database for the main backend server
#
# The database credentials the main backend will use for accounts, files and more.
DB_USER=postgres
DB_PASSWORD=pw
DB_DATABASE=main
DB_HOST=address
DB_PORT=5432

# Database for the chat server
#
# The database credentials the chat server will use for conversations, status
# and more.
CN_DB_USER=postgres
CN_DB_PASSWORD=pw
CN_DB_DATABASE=chat
CN_DB_HOST=address
CN_DB_PORT=5432

# The secret for all JWT tokens used by Liphium, mostly connection tokens.
JWT_SECRET=generate_some_random_value

# File storage configuration
#
# How and where your files are stored.
# This should not be modified unless you know what you are doing. Read:
# https://docs.liphium.com/setup/config-setup.html#file-storage-configuration
FILE_REPO_TYPE=local
FILE_REPO=/home

# SMTP credentials
#
# The SMTP credentials used to connect directly to your mail server.
SMTP_SERVER=mail.example.com
SMTP_PORT=0000
SMTP_IDENTITY=liphium
SMTP_FROM=no-reply@example.com
SMTP_USER=user
SMTP_PW=pw

# A public and private key for reverse proxy protection.
#
# I commented it out here because I wanna prevent weird errors because of station
# generating this automatically and then the user having to paste it into this file.
#
# TC_PUBLIC_KEY=key_here
# TC_PRIVATE_KEY=key_here

# The UUID for the system (will also be printed by station)
# SYSTEM_UUID=uuid_here
</code></pre>
<h3 id="file-storage-configuration"><a class="header" href="#file-storage-configuration">File storage configuration</a></h3>
<p>First of all, <strong>do not change your file storage configuration if there are any files uploaded to your instance</strong>. There are ways to change it, but I currently don't want to write documentation about it. If you run into this case, please create an issue <a href="https://github.com/Liphium/docs">in this repository</a> and I will provide instructions on how to migrate. The process is too complicated to explain here.</p>
<p>If you don't want to change it, but just learn how to configure it, here is an overview:</p>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="Local storage">Local storage</button>
<button class="mdbook-tab" data-tabname="S3-compatible storage">S3-compatible storage</button>
</nav>
<div class="mdbook-tab-content" data-tabname="Local storage">
<p>Configuring local file storage is quite easy. Set the repository type to <code>local</code> and just point it to a directory. In this case we use <code>/home</code> but you can change it to anything. Relative paths (like <code>../storage</code>) are not tested and we have no intention of ever fixing them in case they don't work.</p>
<pre><code class="language-sh">FILE_REPO_TYPE=local
FILE_REPO=/home
</code></pre>
</div>
<div class="mdbook-tab-content hidden" data-tabname="S3-compatible storage">
<p>For any S3-compatible storage, you can configure like specified below. Please don't worry about the <code>r2</code> type. This was implemented when I was using Cloudflare R2 (their S3 compatible storage), but has since then been validated with more S3 providers and should work with any S3-compatible API, in case you experience any issues, please reach out to us.</p>
<p><code>FILE_REPO</code> and <code>FILE_REPO_BUCKET</code> will be concatenate to form a URL that station will reach out to.</p>
<p>Read and write permissions to the the specified bucket are enough. Station will never create buckets or need other ones. Please manage your permissions well.</p>
<pre><code class="language-sh">FILE_REPO_TYPE=r2
FILE_REPO_KEY_ID=s3_key_id
FILE_REPO_KEY=s3_secret_key
FILE_REPO=s3_bucket_url
FILE_REPO_BUCKET=s3_bucket_name
</code></pre>
</div>
</div>
<h2 id="creating-a-new-configuration"><a class="header" href="#creating-a-new-configuration">Creating a new configuration</a></h2>
<p>This guide is specifically for creating an environment/configuration file for your town. If you aren't coming from one of the official tutorials or some installation guide, please follow that first, until you are sent back to this page.</p>
<p><strong>1.</strong> You already created subdomains on your domain for each of the servers that Liphium exposes in step 3. Change the following values of the configuration file above to point to your domain (replace example.com with your domain):</p>
<ul>
<li>BASE_PATH=main.example.com</li>
<li>CHAT_NODE=chat.example.com</li>
<li>SPACE_NODE=spaces.example.com</li>
</ul>
<p><strong>Please do not add https:// or http:// to your domain</strong>. This is a common issue that breaks functionality of Liphium.</p>
<p><strong>2.</strong> You created a main and chat PostgreSQL database before in this guide. Please also fill the data needed for the connection into the following configuration fields:</p>
<ul>
<li>DB_USER=your_username</li>
<li>DB_PASSWORD=your_password</li>
<li>DB_DATABASE=main</li>
<li>DB_HOST=postgres_address (to reach the local system use <code>172.17.0.1</code> instead of <code>localhost</code>, <a href="https://forums.docker.com/t/how-to-reach-localhost-on-host-from-docker-container/113321">here's why</a>)</li>
<li>DB_PORT=5432 (default port of postgres)</li>
</ul>
<p>Now repeat the same for the database configuration of the chat server:</p>
<ul>
<li>CN_DB_USER=your_username</li>
<li>CN_DB_PASSWORD=your_password</li>
<li>CN_DB_DATABASE=chat</li>
<li>CN_DB_HOST=postgres_address (to reach the local system use <code>172.17.0.1</code> instead of <code>localhost</code>, <a href="https://forums.docker.com/t/how-to-reach-localhost-on-host-from-docker-container/113321">here's why</a>)</li>
<li>CN_DB_PORT=5432 (default port of postgres)</li>
</ul>
<p><strong>3.</strong> Please generate a random string on some website or in your favorite password manager to paste into the <code>JWT_SECRET</code> configuration value. Please be sure to make it <strong>extra long</strong> (like <strong>80-100 characters</strong> should be enough) as this is a really important thing that you don't want others to guess. You can also not change this very easily in the future. So make sure you use something random and very long.</p>
<p><strong>4.</strong> Now change the following configuration values for your mail server that Station will use:</p>
<ul>
<li>SMTP_SERVER=mail.example.com (the domain of your mail server, replace <code>example.com</code> with your domain)</li>
<li>SMTP_PORT=your_smtp_port</li>
<li>SMTP_IDENTITY=your_smtp_identity</li>
<li>SMTP_FROM=no-reply@example.com (the email you want Liphium to use)</li>
<li>SMTP_USER=your_smtp_username</li>
<li>SMTP_PW=your_smtp_password</li>
</ul>
<p><strong>5.</strong> Now you need to decide which kind of storage you want to use for your files. If you just want a folder, go to the local storage tab below. If you want to use Cloudflare R2, AWS S3 or other file storage providers, click the tab for that.</p>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="Local storage">Local storage</button>
<button class="mdbook-tab" data-tabname="S3-compatible storage">S3-compatible storage</button>
</nav>
<div class="mdbook-tab-content" data-tabname="Local storage">
<p>With the start command all of our official guides use, station just saves all of the files into the home directory by default, so we'll use that as the example here.</p>
<p>Configuring local file storage is quite easy. Set the <code>FILE_REPO_TYPE</code> to <code>local</code> and just point <code>FILE_REPO</code> to a directory. You can do it just like below.</p>
<pre><code class="language-sh">FILE_REPO_TYPE=local
FILE_REPO=/home
</code></pre>
</div>
<div class="mdbook-tab-content hidden" data-tabname="S3-compatible storage">
<p>For any S3-compatible storage, you can configure like specified below. Please don't worry about the <code>r2</code> type. This was implemented when I was using Cloudflare R2 (their S3 compatible storage), but has since then been validated with more S3 providers and should work with any S3-compatible API, in case you experience any issues, please reach out to us.</p>
<p><code>FILE_REPO</code> and <code>FILE_REPO_BUCKET</code> will be concatenate to form a URL that station will reach out to.</p>
<p>Read and write permissions to the the specified bucket are enough. Station will never create buckets or need other ones. Please manage your permissions well.</p>
<pre><code class="language-sh">FILE_REPO_TYPE=r2
FILE_REPO_KEY_ID=s3_key_id
FILE_REPO_KEY=s3_secret_key
FILE_REPO=s3_bucket_url
FILE_REPO_BUCKET=s3_bucket_name
</code></pre>
</div>
</div>
<p>You've now successfully created a configuration for your town. More values will need to be added, but each tutorial will cover that in the next few steps.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="migration-guides"><a class="header" href="#migration-guides">Migration guides</a></h1>
<p>Welcome to the official place for everything that breaks and changes in Liphium. If anything needs to be changed about your server configuration before updating your Town, you will find it here. Just click on the next version above the version you are currently using right in the sidebar and go through all of the guides until you reach the latest version.</p>
<p>We recommend to not enable auto updates on your Docker container simply due to <strong>breaking changes</strong> that might happen. This is not just during the Beta, but it will occasionally happen due to changes we have to make.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="migration-to-station-050"><a class="header" href="#migration-to-station-050">Migration to station 0.5.0</a></h1>
<p>Just before we start, I just wanted to mention that your town will likely still run even with the current configuration. It's just that if you want to take full advantage of the update and most importantly, Spaces, then I would recommend sticking with me just a little bit longer. It's really not a lot of changes.</p>
<h2 id="everything-that-changed"><a class="header" href="#everything-that-changed">Everything that changed</a></h2>
<ul>
<li>A lot of environment variables are now redundant and no longer needed because LiveKit support was removed with the 0.5.0 update.</li>
<li>A new Nginx configuration has been added to the Docker guide to handle the new port that opened for Spaces.</li>
</ul>
<h2 id="how-to-migrate-to-050"><a class="header" href="#how-to-migrate-to-050">How to migrate to 0.5.0</a></h2>
<p>Let's remove some clutter from your <code>config.env</code> file first. Just as a reference, this is the file where all of your environment variables are stored. If it's not called <code>config.env</code> it doesn't matter.</p>
<p><strong>1.</strong> You can safely remove any environment variable with the prefix <code>SS_LK_</code> as they are not needed anymore due to the removal of LiveKit support.</p>
<p><strong>2.</strong> <code>MAX_FILE_SIZE</code>, <code>MAX_TOTAL_STORAGE</code> and <code>MAX_FAVORITE_STORAGE</code> can also be removed. These things can now be configured by going to Settings &gt; Town &gt; Files.</p>
<p>Now for the Nginx configuration. I actually didn't change a whole lot there, so this is basically just copying a file into a directory. <strong>This part of the migration guide is only important if you followed the official Docker installation tutorial</strong>.</p>
<p><strong>3.</strong> Go to <code>/etc/nginx/sites-available</code> where all of your configurations are stored.</p>
<p><strong>4.</strong> Put the configuration below into a new file called <code>liphium-spaces</code> and add it to the folder and replace <code>spaces.example.com</code> with your domain.</p>
<pre><code class="language-sh">server {
    server_name spaces.example.com;

    # The WebSocket gateway
    location /gateway {
        proxy_http_version 1.1;

        proxy_connect_timeout 7d;
        proxy_send_timeout 7d;
        proxy_read_timeout 7d;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_pass http://localhost:4002/gateway;
    }

    location / {
        proxy_pass http://localhost:4002;
    }
}
</code></pre>
<p><strong>5.</strong> Link the file to the <code>/etc/nginx/sites-enabled</code> folder by running the command below (assuming you still named the file liphium-spaces).</p>
<pre><code class="language-sh">ln -s /etc/nginx/sites-available/liphium-spaces /etc/nginx/sites-enabled/liphium-spaces
</code></pre>
<h2 id="and-a-little-apology"><a class="header" href="#and-a-little-apology">And a little apology</a></h2>
<p>I'm sorry for rolling out this update in such a weird way. I learned from my mistakes and next time I'll make sure to provide migration guides and resources on what's new directly before the update and not when it's already out for a day.</p>
<p>Well, some of the problems with the recent update have already been fixed in a little update called 0.5.1 for the server and v0.5.2 for the client, respectively. I hope that this doesn't happen again and in the future all the releases will be thorougly tested before release. I complain about this myself all the time, so I also wanna prevent it for my own app.</p>
<p>And with that, I wish you a happy rest of your day and a lot of fun with Liphium!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="migration-to-station-060"><a class="header" href="#migration-to-station-060">Migration to station 0.6.0</a></h1>
<p>Hi, it's time for another migration because of another Liphium update, how great! Well this time it's really not a lot, but if you used to official Docker guide to upgrade to this release, you'll have to migrate your Nginx config because it's no longer letting Zap through.</p>
<h2 id="everything-that-changed-1"><a class="header" href="#everything-that-changed-1">Everything that changed</a></h2>
<ul>
<li>Zap got a few performance improvements and an improved chunking size of 1 MB. In our tests this always performed better than the 512 KB we had before. You can read more about that <a href="https://github.com/Liphium/station/tree/main/CHANGELOG.md">in the changelog</a>.</li>
</ul>
<h2 id="how-to-migrate-to-060"><a class="header" href="#how-to-migrate-to-060">How to migrate to 0.6.0</a></h2>
<p>You just have to change your Nginx config for chat server (the thing handling chat messages) and add the following in front of <code>location / {</code>.</p>
<pre><code class="language-sh"># Zap upload endpoint (just to make sure nothing happens)
location /auth/liveshare/upload {
  proxy_http_version 1.1;
  client_max_body_size 1.1m;
  proxy_pass http://localhost:4001/auth/liveshare/upload;
}
</code></pre>
<h2 id="thats-it"><a class="header" href="#thats-it">That's it</a></h2>
<p>Well that's already it for this release. We'll have more changes like this that require a little bit of reconfiguration throughout the year I assume, we wanna add audio and video calls back after all. As usual, thanks for using and supporting Liphium! And with that, I wish you a happy rest of your day.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/tabs.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
